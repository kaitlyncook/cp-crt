# Conditional Power for Cluster-Randomized Trials (CRTs) with Interval-Censored Endpoints

This repository contains all of the data and code needed to replicate the simulation studies and to reproduce the data analysis in the manuscript entitled "Estimation of Conditional Power for Cluster-Randomized Trials with Interval-Censored Endpoints". Code is licensed under the MIT License, and data under the CC-0 License.


## data Folder

This folder contains the data imported in the scripts **data-application.R** and **figure-table-generation.R**. Contents are as follows:

+ **simulated-bcpp.csv**: Simulated interim data patterned after the Botswana Combination Prevention Project (BCPP). Data were generated by using an agent-based epidemic model to propagate HIV infection on a simulated network of dynamic sexual partnerships (see [Goyal et al. (2013)](https://biostats.bepress.com/harvardbiostat/paper137/) and [Wang et al. (2014)](https://pubmed.ncbi.nlm.nih.gov/24651566/) for details). Variable names and descriptions are below.

| Variable Name | Description                                                       | Variable Type |   
|---------------|-------------------------------------------------------------------|---------------|
| group         | Cluster ID                                                        | Integer: 1-30 |   
| pair.id       | Matched Pair ID                                                   | Integer: 1-15 |   
| treat         | Indicator of randomization to combination prevention              | Integer: 0-1  |   
| left          | Left endpoint of the censoring interval for HIV seroconversion  | Numeric       |   
| right         | Right endpoint of the censoring interval for HIV seroconversion | Numeric       |   

+ **"data/simulation-results/"**: Subfolder containing all .csv simulation output files, which are subsequently processed and used to generate all manuscript figures and tables in **figure-table-generation.R**.  Select variable names and descriptions  (shared across most results files) are below.

| Variable Name           | Description                                                                                           | Variable Type |
|-------------------------|-------------------------------------------------------------------------------------------------------|---------------|
| M                       | Number of clusters in the simulated CRT dataset                                                   | Integer       |
| hazard                  | Data-generating baseline hazard function, <img src="https://render.githubusercontent.com/render/math?math=\lambda_0">                                                                       | Numeric       |
| hr                      | Data-generating hazard ratio, <img src="https://render.githubusercontent.com/render/math?math=\exp\{\beta\}">                                                                          | Numeric       |
| f.dist                  | Data-generating frailty distribution                                                                  | Character     |
| f.theta                 | Data-generating frailty parameter, <img src="https://render.githubusercontent.com/render/math?math=\theta">                                                                     | Numeric       |
| actual.f.theta | Estimated <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> in the simulated completed CRT | Numeric |
| int.f.theta | Estimated <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> in the corresponding interim dataset | Numeric |
| actual.hazard.0 | Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{0}"> in the simulated completed CRT | Numeric |
| int.hazard.0 | Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{0}"> in the corresponding interim dataset | Numeric |
| actual.hazard.1 | Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{1}"> in the simulated completed CRT | Numeric |
| int.hazard.1 | Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{1}"> in the corresponding interim dataset | Numeric |
| power                   | Simulated power of the CRT design                                                                     | Numeric       |
| cp                      | Estimated conditional power of the simulated interim dataset                                          | Numeric       |
| proj.mean.f.theta       | Mean estimated <img src="https://render.githubusercontent.com/render/math?math=\theta"> across the 500 projected complete-trial datasets                     | Numeric       |
| proj.mse.f.theta.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> as an estimator of the observed complete-trial quantity | Numeric       |
| proj.mean.hazard.0 | Mean estimated hazard in the control arm, <img src="https://render.githubusercontent.com/render/math?math=\lambda_0">, across the 500 projected complete-trial datasets | Numeric | 
| proj.mse.hazard.0.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_0"> as an estimator of the observed complete-trial quantity | Numeric       |
| proj.mean.hazard.1 | Mean estimated hazard in the intervention arm, <img src="https://render.githubusercontent.com/render/math?math=\lambda_1">, across the 500 projected complete-trial datasets | Numeric | 
| proj.mse.hazard.1.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_1"> as an estimator of the observed complete-trial quantity | Numeric       |
| known.cp                      | Estimated conditional power of the simulated interim dataset with <img src="https://render.githubusercontent.com/render/math?math=\tilde{\lambda}_0">, <img src="https://render.githubusercontent.com/render/math?math=\tilde{\lambda}_1">, and <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> set to their data-generating values                                          | Numeric       |
| known.mean.f.theta       | Mean estimated <img src="https://render.githubusercontent.com/render/math?math=theta"> across the 500 projected complete-trial datasets                     | Numeric       |
| known.mse.f.theta.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> as an estimator of the observed complete-trial quantity | Numeric       |
| known.mean.hazard.0 | Mean estimated hazard in the control arm, <img src="https://render.githubusercontent.com/render/math?math=\lambda_0">, across the 500 projected complete-trial datasets | Numeric | 
| known.mse.hazard.0.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_0"> as an estimator of the observed complete-trial quantity | Numeric       |
| known.mean.hazard.1 | Mean estimated hazard in the intervention arm, <img src="https://render.githubusercontent.com/render/math?math=\lambda_1">, across the 500 projected complete-trial datasets | Numeric | 
| known.mse.hazard.1.actual | MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_1"> as an estimator of the observed complete-trial quantity | Numeric       |


<table class="tg">
<thead>
  <tr>
    <th class="tg-0pky">Variable Name</th>
    <th class="tg-0pky">Description</th>
    <th class="tg-0pky">Variable Type</th>
  </tr>
</thead>
<tbody>
   <tr>
    	<td colspan="3" class="tg-c3ow">Attributes of the CRT Design</td>
  </tr>
  <tr>
    <td class="tg-0pky">M</td>
    <td class="tg-0pky">Number of clusters in the simulated CRT dataset</td>
    <td class="tg-0pky">Integer</td>
  </tr>
  <tr>
    <td class="tg-0pky">hazard</td>
    <td class="tg-0pky">Data-generating baseline hazard function, <img src="https://render.githubusercontent.com/render/math?math=\lambda_0"></td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">hr</td>
    <td class="tg-0pky">Data-generating hazard ratio, <img src="https://render.githubusercontent.com/render/math?math=\exp\{\beta\}"></td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">f.dist</td>
    <td class="tg-0pky">Data-generating frailty distribution</td>
    <td class="tg-0pky">Character</td>
  </tr>
  <tr>
    <td class="tg-0pky">f.theta</td>
    <td class="tg-0pky">Data-generating frailty parameter, <img src="https://render.githubusercontent.com/render/math?math=\theta"></td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">power</td>
    <td class="tg-0pky">Simulated power of the CRT design</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    	<td colspan="3" class="tg-c3ow">Features of the Simulated Complete and Interim Datasets</td>
  </tr>
  <tr>
    <td class="tg-0pky">actual.f.theta</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> in the simulated completed CRT</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">int.f.theta</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> in the corresponding interim dataset</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">actual.hazard.0</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{0}"> in the simulated completed CRT</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">int.hazard.0</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{0}"> in the corresponding interim dataset</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">actual.hazard.1</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{1}"> in the simulated completed CRT</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">int.hazard.1</td>
    <td class="tg-0pky">Estimated <img src="https://render.githubusercontent.com/render/math?math=\bar{\lambda}_{1}"> in the corresponding interim dataset</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    	<td colspan="3" class="tg-c3ow">Conditional Power (<img src="https://render.githubusercontent.com/render/math?math=\tilde{\lambda}_{0}">, <img src="https://render.githubusercontent.com/render/math?math=\tilde{\lambda}_{1}">, <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}">, <img src="https://render.githubusercontent.com/render/math?math=\hat{\bm{\eta}}">)</td>
  </tr>
  <tr>
    <td class="tg-0pky">cp</td>
    <td class="tg-0pky">Estimated conditional power of the simulated interim dataset</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mean.f.theta</td>
    <td class="tg-0pky">Mean estimated  <img src="https://render.githubusercontent.com/render/math?math=\theta"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mse.f.theta.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mean.hazard.0</td>
    <td class="tg-0pky">Mean estimated <img src="https://render.githubusercontent.com/render/math?math=\lambda_0"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mse.hazard.0.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_0"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mean.hazard.1</td>
    <td class="tg-0pky">Mean estimated <img src="https://render.githubusercontent.com/render/math?math=\lambda_1"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">proj.mse.hazard.1.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_1"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
   <tr>
   	<td colspan="3" class="tg-c3ow">Conditional Power (<img src="https://render.githubusercontent.com/render/math?math=\lambda_{0}">, <img src="https://render.githubusercontent.com/render/math?math=\lambda_{1}">, <img src="https://render.githubusercontent.com/render/math?math=\theta">, <img src="https://render.githubusercontent.com/render/math?math=\bm{\eta}">)</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.cp</td>
    <td class="tg-0pky">Estimated conditional power of the simulated interim dataset</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mean.f.theta</td>
    <td class="tg-0pky">Mean estimated  <img src="https://render.githubusercontent.com/render/math?math=\theta"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mse.f.theta.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\theta}"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mean.hazard.0</td>
    <td class="tg-0pky">Mean estimated <img src="https://render.githubusercontent.com/render/math?math=\lambda_0"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mse.hazard.0.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_0"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mean.hazard.1</td>
    <td class="tg-0pky">Mean estimated <img src="https://render.githubusercontent.com/render/math?math=\lambda_1"> across the 500 projected complete-trial datasets</td>
    <td class="tg-0pky">Numeric</td>
  </tr>
  <tr>
    <td class="tg-0pky">known.mse.hazard.1.actual</td>
    <td class="tg-0pky">MSE of these 500 projected <img src="https://render.githubusercontent.com/render/math?math=\hat{\lambda}_1"> as an estimator of the observed complete-trial quantity</td>
    <td class="tg-0pky">Numeric</td>
  </tr>

</tbody>
</table>

% Mention what packages will need to be installed 
% All scripts load the necessary packages, and are written assuming that cp-crt is the working directory